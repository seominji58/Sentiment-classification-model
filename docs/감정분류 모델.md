# ğŸ¯ Saegim Emotion Classification Pipeline Guide

## ğŸ§© í”„ë¡œì íŠ¸ ëª©ì 

- ê°ì„±ëŒ€í™” ë°ì´í„°(`merged.csv`)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ 5ê°œ ê°ì •(í–‰ë³µ/í‰ì˜¨/ë¶ˆì•ˆ/ë¶„ë…¸/ìŠ¬í””)ì„ ë¶„ë¥˜í•˜ëŠ” ëª¨ë¸ì„ í•™ìŠµí•œë‹¤.
    
- Colab ì˜ì¡´ì„ ì œê±°í•˜ê³ , Cursor IDEì—ì„œ **íŒŒì¼ ê¸°ë°˜ êµ¬ì¡°**ë¡œ ì•ˆì •ì ì´ê³  ì¬í˜„ ê°€ëŠ¥í•œ íŒŒì´í”„ë¼ì¸ì„ ë§Œë“ ë‹¤.
    

---

## ğŸ“‚ í´ë” êµ¬ì¡° ì„¤ê³„

emotion-model/  
â”‚  
â”œâ”€â”€ data/  
â”‚ â”œâ”€â”€ merged.csv # ì „ì²´ ë°ì´í„° (text + label)  
â”‚ â””â”€â”€ splits/  
â”‚ â”œâ”€â”€ train.csv  
â”‚ â””â”€â”€ valid.csv  
â”‚  
â”œâ”€â”€ src/  
â”‚ â”œâ”€â”€ __init__.py  
â”‚ â”œâ”€â”€ utils.py  
â”‚ â”œâ”€â”€ data_io.py  
â”‚ â”œâ”€â”€ preprocess.py  
â”‚ â”œâ”€â”€ label_map.py  
â”‚ â”œâ”€â”€ split.py  
â”‚ â”œâ”€â”€ anomaly.py  
â”‚ â”œâ”€â”€ baseline.py  
â”‚ â”œâ”€â”€ transformer.py  
â”‚ â””â”€â”€ evaluation.py  
â”‚  
â”œâ”€â”€ configs/config.json  
â”‚  
â”œâ”€â”€ processed/  
â”‚ â”œâ”€â”€ cleaned.csv  
â”‚ â”œâ”€â”€ label_mapping.json  
â”‚ â”œâ”€â”€ splits/  
â”‚ â”œâ”€â”€ train.csv  
â”‚ â””â”€â”€ valid.csv  
â”‚ â””â”€â”€ models/  
â”‚ â”œâ”€â”€ baseline/  
â”‚ â””â”€â”€ transformer/  
â”‚  
â”œâ”€â”€ scripts/  
â”‚ â”œâ”€â”€ run_all.py  
â”‚ â”œâ”€â”€ train_baseline.py  
â”‚ â”œâ”€â”€ train_transformer.py  
â”‚ â””â”€â”€ check_anomaly.py  
â”‚  
â”œâ”€â”€ requirements.txt  
â””â”€â”€ PIPELINE_GUIDE.md

---

## âš™ï¸ ì‹¤í–‰ í™˜ê²½

- **Python:** 3.11
    
- **IDE:** Cursor / VS Code
    
- **ê°€ìƒí™˜ê²½:** Miniconda ê¶Œì¥
    

ëª…ë ¹ì–´ ì˜ˆì‹œ:  
`conda create -n saegim python=3.11 -y`  
`conda activate saegim`  
`pip install -r requirements.txt`

í•„ìš” íŒ¨í‚¤ì§€:  
`pandas scikit-learn transformers torch datasets joblib tqdm`

---

## ğŸ§  ê°œë°œ ì›ì¹™

**ë³€ìˆ˜ëª… ì¼ê´€ì„±:**  
`merged_df â†’ cleaned_df â†’ final_df â†’ train_df / valid_df`

**ë‹¨ê³„ë³„ ìœ íš¨ì„± ì²´í¬ (í•„ìˆ˜):**

- `assert {'text','label'}.issubset(df.columns)`
    
- `assert len(df) > 0`
    
- ì €ì¥ í›„: `íŒŒì¼ í¬ê¸° í™•ì¸`
    

**ë¼ë²¨ ë§¤í•‘ ë‹¨ì¼ ì§„ì‹¤ì› (Single Source of Truth):**  
ëª¨ë“  ë§¤í•‘ì€ `configs/config.json`ì—ì„œ ë¡œë“œí•œë‹¤.

ì˜ˆì‹œ:  
`{ "label_mapping": { "ê¸°ì¨": "í–‰ë³µ", "ë‹¹í™©": "ë¶ˆì•ˆ", "ë¶„ë…¸": "ë¶„ë…¸", "ìƒì²˜": "ìŠ¬í””", "ìŠ¬í””": "ìŠ¬í””", "ì¤‘ë¦½": "í‰ì˜¨" } }`

---

## ğŸš€ íŒŒì´í”„ë¼ì¸ ë‹¨ê³„

|ë‹¨ê³„|ëª¨ë“ˆ|ê¸°ëŠ¥|ì…ë ¥|ì¶œë ¥|
|---|---|---|---|---|
|1ï¸âƒ£|data_io.py|CSV ë¡œë“œ, íŒŒì¼ ê²€ì¦|merged.csv|merged_df|
|2ï¸âƒ£|preprocess.py|í…ìŠ¤íŠ¸ ì •ì œ ë° ì¤‘ë³µ/ê²°ì¸¡ ì œê±°|merged_df|cleaned_df|
|3ï¸âƒ£|label_map.py|6â†’5 ê°ì • ë§¤í•‘ ë° ê²€ì¦|cleaned_df|final_df|
|4ï¸âƒ£|split.py|Stratified 90/10 ë¶„í• |final_df|train.csv, valid.csv|
|5ï¸âƒ£|anomaly.py|TF-IDF ê¸°ë°˜ ì´ìƒì¹˜ íƒì§€|train.csv|anomaly_samples.csv|
|6ï¸âƒ£|baseline.py|TF-IDF + LinearSVC í•™ìŠµ|train/valid|metrics.json|
|7ï¸âƒ£|transformer.py|HuggingFace Trainer ê¸°ë°˜ ëª¨ë¸|train/valid|best model|
|8ï¸âƒ£|evaluation.py|Macro-F1, Confusion Matrix ê³„ì‚°|valid|metrics.json|

---

## ğŸ”’ ìœ í‹¸ (`src/utils.py`)

- ë‹¨ê³„ í†µê³¼ í‘œì‹œ: `mark_ok(step)`
    
- ë‹¨ê³„ ìš”êµ¬ í™•ì¸: `require(step)`
    
- ê²°ì¸¡/ë¹ˆ ë°ì´í„° ê²€ì¦: `must_have_cols(df, cols)`, `must_not_empty(df)`
    
- CSV ì €ì¥ ì‹œ íŒŒì¼ í¬ê¸° í™•ì¸ í•„ìˆ˜
    
- ë¡œê·¸: `log_step(name, **stats)`
    

---

## ğŸ§© ì‹¤í–‰ ìˆœì„œ (`scripts/run_all.py`)

1. `merged_df = data_io.load_merged("data/merged.csv")`
    
2. `cleaned_df = preprocess.clean(merged_df)`
    
3. `final_df = label_map.apply_mapping(cleaned_df, "configs/config.json")`
    
4. `train_df, valid_df = split.make_splits(final_df, 0.1)`
    
5. `anomaly.check_labels(train_df)`
    
6. `baseline.train_and_evaluate(train_df, valid_df)`
    
7. `transformer.train(train_df, valid_df)`
    

---

## ğŸ“ˆ í‰ê°€ ì§€í‘œ

- Accuracy
    
- Macro F1 Score
    
- Confusion Matrix
    
- Class Precision / Recall
    

ì €ì¥ ê²½ë¡œ:

- `processed/models/baseline/metrics.json`
    
- `processed/models/transformer/metrics.json`
    

---

## ğŸ“œ ê°œë°œ ì£¼ì˜ ìš”ì•½

1. ë¼ë²¨ ë§¤í•‘ì€ ë°˜ë“œì‹œ configì—ì„œ ë¡œë“œ.
    
2. ì „ì œì¡°ê±´ ë¶ˆë§Œì¡± ì‹œ ì¦‰ì‹œ ì¤‘ë‹¨ (`RuntimeError`).
    
3. íŒŒì¼ ì €ì¥ í›„ ë°˜ë“œì‹œ í¬ê¸° ê²€ì¦.
    
4. ì˜¤ë¥˜ëŠ” ëª…í™•íˆ raise.
    
5. `python scripts/run_all.py` í•œ ë²ˆìœ¼ë¡œ ì „ì²´ ì‹¤í–‰ ê°€ëŠ¥í•´ì•¼ í•¨.
    

---

## âœ… ì™„ì„± ê¸°ì¤€

- ëª¨ë“  ë‹¨ê³„ê°€ ì˜¤ë¥˜ ì—†ì´ í†µê³¼.
    
- `processed` ë‚´ë¶€ì— ì‚°ì¶œë¬¼ ìƒì„±.
    
- Transformerì˜ Macro-F1 â‰¥ Baseline.
    
- ë™ì¼ ë°ì´í„°ë¡œ ì¬í˜„ ê°€ëŠ¥.
    

---

## âš ï¸ ADDENDUM (Pipeline Tips)

- ì „ì²˜ë¦¬ëŠ” split ì´ì „ì—ë§Œ ìˆ˜í–‰.
    
- ë¼ë²¨ ë§¤í•‘ì€ `config.json` ë‹¨ì¼ ì§„ì‹¤ì›ì—ì„œ ë¡œë“œ.
    
- Stratified Split ì‹¤íŒ¨ ì‹œ í´ë°± ì˜µì…˜ `--allow-random-split`.
    
- TF-IDFëŠ” `char_wb (3~5)` ì¶”ì²œ.
    
- TransformerëŠ” `klue/roberta-base`, macro-F1 ê¸°ì¤€ early stopping.